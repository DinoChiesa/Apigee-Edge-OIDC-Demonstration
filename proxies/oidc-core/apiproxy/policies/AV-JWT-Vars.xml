<AssignMessage name="AV-JWT-Vars">
  <AssignVariable>
    <Name>jwt_aud</Name>
    <Ref>client_id</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>jwt_sub</Name>
    <Ref>request.formparam.email</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>email</Name>
    <Ref>request.formparam.email</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>jwt_expires_in</Name>
    <Value>300s</Value>
  </AssignVariable>
  <AssignVariable>
    <Name>jwt_issuer</Name>
    <Template>{request.header.x-forwarded-proto}://{request.header.host}{proxy.basepath}</Template>
  </AssignVariable>
  <AssignVariable>
    <Name>nonce</Name>
    <Ref>nonce</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>preferred_username</Name>
    <Ref>request.formparam.username</Ref>>
  </AssignVariable>
  <AssignVariable>
    <Name>name</Name>
    <Ref>request.formparam.name</Ref>>
  </AssignVariable>
  <AssignVariable>
    <Name>given_name</Name>
    <Ref>request.formparam.given_name</Ref>>
  </AssignVariable>
  <AssignVariable>
    <Name>family_name</Name>
    <Ref>request.formparam.family_name</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>motto</Name>
    <Ref>request.formparam.motto</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>picture</Name>
    <Ref>request.formparam.picture</Ref>>
  </AssignVariable>
  <AssignVariable>
    <Name>grant_type</Name>
    <Ref>request.formparam.grant_type</Ref>>
  </AssignVariable>
  <AssignVariable>
    <Name>token_type</Name>
    <Value>Bearer</Value>
  </AssignVariable>
  <!-- optionally overwrites scope retrieved from session -->
  <AssignVariable>
    <Name>scope</Name>
    <Ref>request.formparam.req_scope</Ref>
  </AssignVariable>

  <AssignVariable>
    <Name>sessionid</Name>
    <Ref>request.formparam.sessionid</Ref>
  </AssignVariable>
  <AssignVariable>
    <Name>private.secretkey</Name>
    <!-- ideally this should be at least 32 bytes  -->
    <Template>{oauthv2client.Get-Application-Attributes.client_secret}</Template>
  </AssignVariable>
  <IgnoreUnresolvedVariables>true</IgnoreUnresolvedVariables>
  <AssignTo createNew="false" transport="http" type="request"/>
</AssignMessage>
